<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shirt Product</title>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
</head>
<body style="margin: 0; background-color: #1a1a1a">
  <a-scene>
    <!-- Background -->
    <a-sky src="images/room.png" rotation="0 -90 0"></a-sky>

    <!-- Lighting -->
    <a-entity light="type: ambient; intensity: 0.6; color: #ffffff"></a-entity>
    <a-entity light="type: directional; intensity: 0.9; color: #ffffff" position="0 4 -2" target="#shirt"></a-entity>
    <a-entity light="type: point; intensity: 0.4; distance: 6; decay: 2; color: #ffffff" position="0 2 -3"></a-entity>

    <!-- Assets -->
    <a-assets>
      <a-asset-item id="shirtModel" src="models/oversized_t-shirt.glb"></a-asset-item>
      <img id="logo" src="images/Logo.png" />
      <img id="cart" src="images/Cart.png" />
      <img id="cart-white" src="images/cartwhite.png" />
      <audio id="bg-music" src="sounds/music.mp3"></audio>
      <audio id="click-sound" src="sounds/pop.flac"></audio>
    </a-assets>

    <!-- Music -->
    <a-sound id="backgroundSound" src="#bg-music" loop="true" volume="0.5"></a-sound>

    <!-- Camera -->
    <a-entity camera position="0 2 0" look-controls>
      <a-cursor color="#fff"></a-cursor>
    </a-entity>

    <!-- Header -->
    <a-image src="#logo" width="0.6" height="0.15" position="-2 3 -3" link="href: index.html"></a-image>
    <a-image src="#cart-white" width="0.2" height="0.2" position="2 3 -3"></a-image>

    <!-- Cart Bubble -->
    <a-circle id="cartBubble" radius="0.1" color="#fff" position="2.15 3.1 -2.99" visible="false">
      <a-text id="cartCount" value="0" align="center" color="#000" position="0 0 0.01" width="2"></a-text>
    </a-circle>

    <!-- Shirt Model -->
    <a-entity id="shirt" position="0 -0.5 -3" pickable-hat>
      <a-gltf-model src="#shirtModel" scale="2 2 2"></a-gltf-model>
    </a-entity>

    <!-- Price Tag -->
    <a-entity id="priceTag" position="0 0.6 -3">
      <a-plane color="#333" width="1" height="0.3" opacity="0.8">
        <a-text value="$24.99" color="#fff" align="center" width="3" position="0 0 0.01"></a-text>
      </a-plane>
    </a-entity>

    <!-- Description -->
    <a-entity id="descriptionPanel" position="0 0.2 -3">
      <a-plane color="#111" width="1.6" height="0.5" opacity="0.7">
        <a-text value="Oversized T-shirt made from 100% cotton.\nComfortable and stylish." 
                color="#fff" align="center" width="1.5" position="0 0 0.01" wrap-count="40">
        </a-text>
      </a-plane>
    </a-entity>

    <!-- Buttons -->
    <a-plane id="addCartBtn" position="0 -0.3 -3" width="1.5" height="0.3" color="#fff" class="clickable cart-button" hover-effect sound-click>
      <a-image src="#cart" width="0.15" height="0.15" position="-0.45 0 0.01"></a-image>
      <a-text value="Add to Cart" color="#000" align="left" position="-0.25 0 0.01" width="2"></a-text>
    </a-plane>

    <a-plane id="checkoutBtn" position="0 -0.75 -3" width="1.5" height="0.3" color="#4CAF50" class="clickable" hover-effect link="href: checkout.html" sound-click>
      <a-text value="Checkout" color="#fff" align="center" position="0 0 0.01" width="2"></a-text>
    </a-plane>

    <a-plane id="backBtn" position="0 -1.2 -3" width="1.5" height="0.3" color="#f44336" class="clickable" hover-effect link="href: index.html" sound-click>
      <a-text value="Back to Shop" color="#fff" align="center" position="0 0 0.01" width="2"></a-text>
    </a-plane>

    <!-- COMPONENTS -->
    <script>
      AFRAME.registerComponent('pickable-hat', {
        schema: { speed: { default: 1 }, resetTime: { default: 600 } },
        init: function () {
          const el = this.el;
          const startRotation = el.object3D.rotation.clone();
          const startPosition = el.object3D.position.clone();
          let isDragging = false;
          let previousX = 0, previousY = 0;

          el.sceneEl.canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            previousX = e.screenX;
            previousY = e.screenY;
          });
          window.addEventListener('mouseup', () => {
            if (isDragging) {
              isDragging = false;
              new TWEEN.Tween(el.object3D.rotation)
                .to({ x: startRotation.x, y: startRotation.y, z: startRotation.z }, this.data.resetTime)
                .easing(TWEEN.Easing.Quadratic.Out).start();
              new TWEEN.Tween(el.object3D.position)
                .to({ x: startPosition.x, y: startPosition.y, z: startPosition.z }, this.data.resetTime)
                .easing(TWEEN.Easing.Quadratic.Out).start();
            }
          });
          window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const deltaX = e.screenX - previousX;
            const deltaY = e.screenY - previousY;
            el.object3D.rotation.y += deltaX * 0.005 * this.data.speed;
            el.object3D.rotation.x += deltaY * 0.005 * this.data.speed;
            previousX = e.screenX;
            previousY = e.screenY;
          });

          window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') el.object3D.rotation.y += 0.1;
            if (e.key === 'ArrowRight') el.object3D.rotation.y -= 0.1;
          });
        },
        tick: function () {
          TWEEN.update();
        }
      });

      AFRAME.registerComponent('hover-effect', {
        init: function () {
          const el = this.el;
          el.addEventListener('mouseenter', () => el.setAttribute('scale', '1.05 1.05 1'));
          el.addEventListener('mouseleave', () => el.setAttribute('scale', '1 1 1'));
        }
      });

      AFRAME.registerComponent('sound-click', {
        init: function () {
          const el = this.el;
          el.addEventListener('click', () => {
            const sound = document.querySelector('#click-sound');
            if (sound) sound.play();
          });
        }
      });
    </script>

    <!-- Add to Cart Logic -->
    <script>
      let cartCount = localStorage.getItem('cartCount') ? parseInt(localStorage.getItem('cartCount')) : 0;
      let cartItems = localStorage.getItem('cartItems') ? JSON.parse(localStorage.getItem('cartItems')) : [];

      const btn = document.querySelector('#addCartBtn');
      const cartText = document.querySelector('#cartCount');
      const cartBubble = document.querySelector('#cartBubble');

      if (cartCount > 0) {
        cartText.setAttribute('value', cartCount.toString());
        cartBubble.setAttribute('visible', true);
      }

      btn.addEventListener('click', () => {
        cartCount++;
        cartItems.push({ product: "Shirt", price: 24.99 });
        localStorage.setItem('cartCount', cartCount);
        localStorage.setItem('cartItems', JSON.stringify(cartItems));
        cartText.setAttribute('value', cartCount.toString());
        cartBubble.setAttribute('visible', true);

        new TWEEN.Tween(cartBubble.object3D.scale)
          .to({ x: 1.3, y: 1.3, z: 1.3 }, 100)
          .easing(TWEEN.Easing.Quadratic.Out)
          .yoyo(true)
          .repeat(1)
          .start();
      });
    </script>

    <!-- Background Music Trigger -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const bgSound = document.querySelector('#backgroundSound');
        const clickToPlay = () => {
          if (bgSound && !bgSound.components.sound.isPlaying) {
            bgSound.components.sound.playSound();
            window.removeEventListener('click', clickToPlay);
          }
        };
        window.addEventListener('click', clickToPlay);
      });
    </script>
  </a-scene>
</body>
</html>
